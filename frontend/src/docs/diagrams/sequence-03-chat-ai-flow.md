# Sequence Diagram 3: Chat Message with AI (OpenAI + NLP)

```
â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”
â”‚Userâ”‚ â”‚Chatâ”‚ â”‚Firebaseâ”‚ â”‚  FAQ   â”‚ â”‚ OpenAI â”‚ â”‚  NLP   â”‚ â”‚Firebaseâ”‚ â”‚Chatâ”‚
â”‚    â”‚ â”‚ UI â”‚ â”‚Firestoreâ”‚ â”‚ Search â”‚ â”‚  API   â”‚ â”‚ Engine â”‚ â”‚Firestoreâ”‚ â”‚ UI â”‚
â””â”€â”¬â”€â”€â”˜ â””â”€â”¬â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”¬â”€â”€â”˜
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚ Type Question  â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚ "What are the â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚ library hours?"â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚â”€â”€â”€â”€â”€>â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚ Press Send     â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚â”€â”€â”€â”€â”€>â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Create Message Object         â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ {                              â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   id: uuid(),                  â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   content: "What are...",      â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   sender: "user",              â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   timestamp: now()             â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ }                              â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Display User Message           â”‚          â”‚          â”‚        â”‚
  â”‚<â”€â”€â”€â”€â”€â”¤        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Save User Message to Firestore â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚ Update Chat Document  â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚ Add message to array  â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Saved  â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚<â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Show "AI is typing..." animation          â”‚          â”‚        â”‚
  â”‚<â”€â”€â”€â”€â”€â”¤        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚ STEP 1: PREPROCESSING & KEYWORD EXTRACTION          â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Extract Keywords   â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ - "library"        â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ - "hours"          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚ STEP 2: FAQ SEMANTIC SEARCH                         â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Search FAQs in Firestore      â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚ Query FAQs collectionâ”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚ WHERE keywords array â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚ CONTAINS "library"   â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚ OR category = "Library"         â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Matched FAQs:      â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ [                  â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   {                â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚     question: "What are library hours?", â”‚          â”‚        â”‚
  â”‚      â”‚     answer: "Mon-Fri: 8AM-8PM...",       â”‚          â”‚        â”‚
  â”‚      â”‚     category: "Library",                 â”‚          â”‚        â”‚
  â”‚      â”‚     keywords: ["library", "hours", ...]  â”‚          â”‚        â”‚
  â”‚      â”‚   }                â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ ]                  â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚ STEP 3: BUILD CONTEXT FOR OPENAI                    â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Build Prompt:      â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚        â”‚
  â”‚      â”‚ â”‚ System Prompt:                          â”‚         â”‚        â”‚
  â”‚      â”‚ â”‚ "You are an AI assistant for HCK       â”‚         â”‚        â”‚
  â”‚      â”‚ â”‚  College. Help students with inquiries â”‚         â”‚        â”‚
  â”‚      â”‚ â”‚  about admissions, courses, library,   â”‚         â”‚        â”‚
  â”‚      â”‚ â”‚  fees, hostel, events, placements,     â”‚         â”‚        â”‚
  â”‚      â”‚ â”‚  and contact info. Be helpful and      â”‚         â”‚        â”‚
  â”‚      â”‚ â”‚  accurate."                             â”‚         â”‚        â”‚
  â”‚      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚        â”‚
  â”‚      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚        â”‚
  â”‚      â”‚ â”‚ Context (from matched FAQs):            â”‚         â”‚        â”‚
  â”‚      â”‚ â”‚ "Relevant information:                  â”‚         â”‚        â”‚
  â”‚      â”‚ â”‚  - Library Hours: Mon-Fri 8AM-8PM,     â”‚         â”‚        â”‚
  â”‚      â”‚ â”‚    Sat-Sun 9AM-6PM                     â”‚         â”‚        â”‚
  â”‚      â”‚ â”‚  - Library facilities: Study rooms,    â”‚         â”‚        â”‚
  â”‚      â”‚ â”‚    computers, WiFi, printing"          â”‚         â”‚        â”‚
  â”‚      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚        â”‚
  â”‚      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚        â”‚
  â”‚      â”‚ â”‚ Chat History (last 5 messages):        â”‚         â”‚        â”‚
  â”‚      â”‚ â”‚ [Previous conversation context]        â”‚         â”‚        â”‚
  â”‚      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚        â”‚
  â”‚      â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚        â”‚
  â”‚      â”‚ â”‚ User Question:                          â”‚         â”‚        â”‚
  â”‚      â”‚ â”‚ "What are the library hours?"          â”‚         â”‚        â”‚
  â”‚      â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚ STEP 4: SEND TO OPENAI API                          â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ POST /v1/chat/completions     â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Request Body:      â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ {                  â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   "model": "gpt-4",â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   "messages": [    â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚     {              â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚       "role": "system",       â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚       "content": "{system_prompt}"       â”‚          â”‚        â”‚
  â”‚      â”‚     },             â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚     {              â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚       "role": "user",         â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚       "content": "What are the library hours?"      â”‚        â”‚
  â”‚      â”‚     }              â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   ],               â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   "temperature": 0.7,         â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   "max_tokens": 500           â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ }                  â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Headers:           â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Authorization: Bearer {OPENAI_API_KEY}   â”‚          â”‚        â”‚
  â”‚      â”‚ Content-Type: application/json           â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚ STEP 5: NLP PROCESSING (Inside OpenAI)              â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚ Tokenization         â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚ Intent Classificationâ”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚ (Information Query)  â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚ Entity Extraction    â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚ - "library" (Subject)â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚ - "hours" (Attribute)â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚ Context Understandingâ”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚ (Use FAQ context)    â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚ Response Generation  â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚ (Natural Language)   â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚ STEP 6: RECEIVE AI RESPONSE                         â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ OpenAI Response:   â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ {                  â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   "id": "chatcmpl-abc123",    â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   "object": "chat.completion",â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   "created": 1234567890,      â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   "model": "gpt-4",           â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   "choices": [                â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚     {                          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚       "message": {             â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚         "role": "assistant",   â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚         "content": "The HCK College library is open â”‚        â”‚
  â”‚      â”‚                     Monday to Friday from 8:00 AM   â”‚        â”‚
  â”‚      â”‚                     to 8:00 PM, and on weekends     â”‚        â”‚
  â”‚      â”‚                     from 9:00 AM to 6:00 PM. The    â”‚        â”‚
  â”‚      â”‚                     library offers study rooms,     â”‚        â”‚
  â”‚      â”‚                     computers, WiFi, and printing   â”‚        â”‚
  â”‚      â”‚                     services. Is there anything     â”‚        â”‚
  â”‚      â”‚                     else you'd like to know?"        â”‚        â”‚
  â”‚      â”‚       },                       â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚       "finish_reason": "stop"  â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚     }                          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   ],                           â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   "usage": {                   â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚     "prompt_tokens": 150,      â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚     "completion_tokens": 80,   â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚     "total_tokens": 230        â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   }                            â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ }                              â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Extract AI Response Content    â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ "The HCK College library is open..."     â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚ STEP 7: SAVE AI RESPONSE TO FIRESTORE               â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Create AI Message Object       â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ {                              â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   id: uuid(),                  â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   content: "The HCK College...",          â”‚          â”‚        â”‚
  â”‚      â”‚   sender: "ai",                â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   timestamp: now(),            â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚   feedback: null               â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ }                              â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Save AI Message to Firestore   â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚ Update Chat Document  â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚ Add AI message        â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚ Update timestamp      â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Saved  â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚<â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚ STEP 8: DISPLAY RESPONSE TO USER                    â”‚        â”‚
  â”‚      â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Hide "AI is typing..."         â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Display AI Response with:      â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ â€¢ Message content              â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ â€¢ Timestamp                    â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ â€¢ [ðŸ‘ Helpful] button          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ â€¢ [ðŸ‘Ž Not Helpful] button      â”‚          â”‚          â”‚        â”‚
  â”‚<â”€â”€â”€â”€â”€â”¤        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚ Read AI Response           â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
  â”‚ STEP 9: USER FEEDBACK (OPTIONAL)                                    â”‚
  â”‚ â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚ Click "ðŸ‘ Helpful"         â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚â”€â”€â”€â”€â”€>â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Update Message Feedback        â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€>â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚ Update message.feedback = "helpful"        â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Updatedâ”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚<â”€â”€â”€â”€â”€â”€â”€â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Track Analytics    â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚ Update analytics/{date}       â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚ Increment helpfulResponses    â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚ Recalculate accuracy          â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Analytics Updated  â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚ Show Success: "Thank you for your feedback!"        â”‚        â”‚
  â”‚<â”€â”€â”€â”€â”€â”¤        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â”‚      â”‚        â”‚          â”‚          â”‚          â”‚          â”‚        â”‚
  â–¼      â–¼        â–¼          â–¼          â–¼          â–¼          â–¼        â–¼


NLP CAPABILITIES USED:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. TOKENIZATION
   â€¢ Break text into words/tokens
   â€¢ "What are the library hours?" â†’ ["What", "are", "the", "library", "hours"]

2. INTENT CLASSIFICATION
   â€¢ Information Query (question about hours)
   â€¢ Request Type: Factual Information

3. ENTITY RECOGNITION
   â€¢ Subject: "library" (Place/Facility)
   â€¢ Attribute: "hours" (Time Information)

4. SEMANTIC UNDERSTANDING
   â€¢ Understands "hours" means "operating hours"
   â€¢ Recognizes context from FAQs

5. CONTEXT AWARENESS
   â€¢ Uses previous messages for continuity
   â€¢ References college-specific information

6. RESPONSE GENERATION
   â€¢ Natural language synthesis
   â€¢ Friendly, helpful tone
   â€¢ Complete, accurate information


OPENAI API PARAMETERS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â€¢ model: "gpt-4" or "gpt-3.5-turbo"
  â†’ More intelligent vs. faster/cheaper

â€¢ temperature: 0.7
  â†’ Creativity level (0=deterministic, 1=creative)
  â†’ 0.7 balances accuracy with natural responses

â€¢ max_tokens: 500
  â†’ Maximum response length
  â†’ Prevents overly long responses

â€¢ messages: Array of conversation history
  â†’ Maintains context across turns


FAQ SEARCH STRATEGY:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. Keyword Matching
   Extract keywords â†’ ["library", "hours"]
   
2. Category Filtering
   Match category â†’ "Library"
   
3. Semantic Similarity
   Compare question similarity using embeddings
   
4. Return Top Matches
   Most relevant FAQs to provide context


ANALYTICS TRACKING:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

On Each Message:
â€¢ Increment totalQueries
â€¢ Track category (if identified)
â€¢ Record timestamp
â€¢ Link to user ID

On Feedback:
â€¢ Update helpfulResponses or notHelpfulResponses
â€¢ Calculate accuracy: helpful / (helpful + notHelpful)
â€¢ Update real-time dashboard


ERROR HANDLING:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. OpenAI API Error:
   â†’ Retry 3 times with exponential backoff
   â†’ Show: "AI temporarily unavailable. Try again."

2. No FAQs Found:
   â†’ Use general system prompt only
   â†’ AI generates response without FAQ context

3. Network Timeout:
   â†’ Show: "Request timed out. Please try again."
   â†’ Allow retry

4. Rate Limit:
   â†’ Show: "Too many requests. Wait a moment."
   â†’ Implement queue system
```

---

**This sequence diagram shows the complete flow of a chat message with AI, including NLP processing, FAQ search, OpenAI API integration, and user feedback tracking.**

**Next: Sequence Diagram 4 - Admin FAQ Management**
